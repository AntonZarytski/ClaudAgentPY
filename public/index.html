<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Chat Agent</title>
    <style>
        * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
        }

        body {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          display: flex;
          justify-content: center;
          align-items: center;
          min-height: 100vh;
          padding: 20px;
        }

        .container {
          background: white;
          border-radius: 16px;
          box-shadow: 0 10px 40px rgba(0,0,0,0.2);
          width: 100%;
          max-width: 700px;
          overflow: hidden;
        }

        .header {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
          padding: 20px;
          text-align: center;
        }

        .header h1 {
          font-size: 24px;
          font-weight: 600;
        }

        #chat {
          height: 450px;
          overflow-y: auto;
          padding: 20px;
          background: #f8f9fa;
          display: flex;
          flex-direction: column;
          gap: 12px;
        }

        .message {
          padding: 12px 16px;
          border-radius: 12px;
          max-width: 80%;
          word-wrap: break-word;
          animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
          from {
            opacity: 0;
            transform: translateY(10px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        .user {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
          align-self: flex-end;
          margin-left: auto;
        }

        .assistant {
          background: white;
          color: #333;
          border: 1px solid #e0e0e0;
          align-self: flex-start;
        }

        .input-group {
          display: flex;
          gap: 10px;
          padding: 20px;
          background: white;
          border-top: 1px solid #e0e0e0;
        }

        input {
          flex: 1;
          padding: 14px 18px;
          border: 2px solid #e0e0e0;
          border-radius: 24px;
          font-size: 15px;
          outline: none;
          transition: border-color 0.3s;
        }

        input:focus {
          border-color: #667eea;
        }

        button {
          padding: 14px 28px;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
          border: none;
          border-radius: 24px;
          cursor: pointer;
          font-size: 15px;
          font-weight: 600;
          transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover:not(:disabled) {
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
          opacity: 0.6;
          cursor: not-allowed;
        }

        .loading {
          display: inline-block;
          width: 8px;
          height: 8px;
          border-radius: 50%;
          background: #667eea;
          animation: bounce 1.4s infinite ease-in-out;
        }

        @keyframes bounce {
          0%, 80%, 100% {
            transform: scale(0);
          }
          40% {
            transform: scale(1);
          }
        }

        /* Scrollbar styling */
        #chat::-webkit-scrollbar {
          width: 6px;
        }

        #chat::-webkit-scrollbar-track {
          background: #f1f1f1;
        }

        #chat::-webkit-scrollbar-thumb {
          background: #667eea;
          border-radius: 3px;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>Hello Claude Chat Agent</h1>
    </div>
    <div id="chat"></div>
    <div class="input-group">
        <input
                id="input"
                type="text"
                placeholder="Введи свой вопрос..."
                onkeypress="if(event.key==='Enter') sendMessage()"
                autocomplete="off"
        >
        <button onclick="sendMessage()" id="sendBtn">Отправить</button>
    </div>
</div>

<script>
    const chat = document.getElementById('chat');
    const input = document.getElementById('input');
    const sendBtn = document.getElementById('sendBtn');

    async function sendMessage() {
      const message = input.value.trim();
      if (!message) return;

      addMessage('user', message);
      input.value = '';
      sendBtn.disabled = true;
      sendBtn.innerHTML = '<span class="loading"></span> Думаю...';

      try {
        const response = await fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message })
        });

        const data = await response.json();

        if (data.error) {
          addMessage('assistant', '❌ ' + data.error);
        } else {
          addMessage('assistant', data.reply);
        }
      } catch (error) {
        addMessage('assistant', '❌ Ошибка соединения с сервером');
        console.error('Error:', error);
      }

      sendBtn.disabled = false;
      sendBtn.textContent = 'Отправить';
      input.focus();
    }

    function addMessage(role, text) {
      const div = document.createElement('div');
      div.className = `message ${role}`;
      div.textContent = text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    // Приветственное сообщение
    addMessage('assistant', 'Привет! Я Claude, твой AI-ассистент. Чем могу помочь?');

    // Фокус на инпут при загрузке
    input.focus();
</script>
</body>
</html>